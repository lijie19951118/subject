import{g as A,_ as C,d as V,h as B,E as G,i as H,p as U,j as J,k as Y}from"./index-ccf67d04.js";import{a as v,d as z,y as F,l as n,m as a,p as t,F as N,a7 as I,U as i,O as y,T as m,I as $,u as h,R as b,S as M,av as j,aw as K,n as W}from"./myVue-ccd9a49f.js";function q(d){const r="ws://www.fulili.cn:8001",o=new WebSocket(r),u=localStorage.getItem("userName"),f=()=>{c()};function c(){o.addEventListener("open",g),o.addEventListener("close",p),o.addEventListener("drror",k),o.addEventListener("message",d)}function g(){console.log("————————连接成功——————");const _={time:new Date().getTime(),userName:u,message:`${u}进入聊天室`,mode:"INTO"};o.send(JSON.stringify(_))}function p(){console.log("————————连接关闭——————")}function k(_){console.log("————————连接报错——————",_),A.alert("连接超时","提示",{callback:()=>{console.log(1)}})}return f(),o}const T=d=>(j("data-v-9fb86e2b"),d=d(),K(),d),P={class:"chat"},Q={class:"room"},X=T(()=>t("div",{class:"header"},"多人聊天室",-1)),Z={class:"body"},ee={class:"member-content"},se={class:"name"},te={key:0,class:"bubble"},oe=["src"],ne={class:"time"},ae={key:1,class:"system-message"},le={class:"input"},ce={class:"tools"},ie={class:"btn-box"},de=T(()=>t("span",{class:"tag"},"shift + 回车键 换行",-1)),re={class:"member-list"},ue={__name:"index",setup(d){const r=q(k),o=localStorage.getItem("userName"),u=v(null),f=v(null),c=v(""),g=v([]),p=v([]);async function k(e){e=JSON.parse(e.data),e.mode==="ROOM"?g.value=e.userList:(p.value.push(e),c.value="",await W(),L())}function _(){if(c.value==="")return;const e={time:new Date().getTime(),userName:o,message:c.value,mode:"MESSAGE"};r.send(JSON.stringify(e))}function x(e){e.keyCode==13&&!e.shiftKey&&(e.preventDefault(),_())}function L(){u.value.scrollTo({top:u.value.scrollHeight,left:0,behavior:"smooth"})}function O(e){e=e.target.files[0];const l=new FileReader;l.addEventListener("load",()=>{const w={time:new Date().getTime(),userName:o,message:l.result,mode:"IMAGE"};r.send(JSON.stringify(w)),console.log(f.value.value=null)}),l.readAsDataURL(e)}return z(()=>{}),F(()=>{const e={time:new Date().getTime(),userName:o,message:`${o}退出了聊天室`,mode:"OUT"};r.send(JSON.stringify(e)),r.close()}),(e,l)=>{const w=V,S=Y,D=B,R=G;return n(),a("div",P,[t("div",Q,[X,t("div",Z,[t("div",ee,[t("div",{class:"view",ref_key:"viewRef",ref:u},[(n(!0),a(N,null,I(p.value,(s,E)=>(n(),a("div",{key:E},[s.mode==="MESSAGE"||s.mode==="IMAGE"?(n(),a("div",{key:0,class:$(["talk",h(o)===s.userName&&"talk-me"])},[t("div",se,m(s.userName),1),s.mode==="MESSAGE"?(n(),a("div",te,m(s.message),1)):b("",!0),s.mode==="IMAGE"?(n(),a("img",{key:1,class:"image-message",src:s.message,alt:""},null,8,oe)):b("",!0),t("div",ne,m(h(H)(parseInt(s.time)).format("YYYY-MM-DD HH:mm:ss")),1)],2)):b("",!0),s.mode==="INTO"||s.mode==="OUT"?(n(),a("div",ae,m(s.message),1)):b("",!0)]))),128))],512),t("div",le,[i(w,{class:"message",modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=s=>c.value=s),rows:10,type:"textarea",placeholder:"输入信息...",resize:"none","input-style":"border: none",onKeydown:x},null,8,["modelValue"]),t("div",ce,[i(D,{underline:!1,onClick:l[1]||(l[1]=s=>f.value.click())},{default:y(()=>[i(S,{size:"30",color:"#bababa"},{default:y(()=>[i(h(U))]),_:1})]),_:1})]),t("div",ie,[de,i(R,{type:"primary",onClick:_},{default:y(()=>[M("发送")]),_:1}),t("input",{style:{display:"none"},ref_key:"imageRef",ref:f,type:"file",accept:"image/*",onChange:O},null,544)])])]),t("div",re,[t("p",null,"当前在线人数："+m(g.value.length)+" 人",1),(n(!0),a(N,null,I(g.value,(s,E)=>(n(),a("div",{key:E},[i(S,null,{default:y(()=>[i(h(J))]),_:1}),M(" "+m(s),1)]))),128))])])])])}}},fe=C(ue,[["__scopeId","data-v-9fb86e2b"]]);export{fe as default};
