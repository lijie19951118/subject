import{n as R,r as v,U as V,o as B,f as n,g as l,j as t,F as N,G as I,k as d,l as p,t as _,s as H,a2 as J,p as U,J as Y,I as y,h,a3 as z,a4 as F,m as M,a5 as K,O as $,P as j,K as W,T as q}from"./vendor-52091f21.js";import{_ as P,r as Q}from"./index-66febafa.js";function X(u,a){const c="ws://www.fulili.cn:8001",o=new WebSocket(c),m=()=>{r()};function r(){o.addEventListener("open",a),o.addEventListener("close",f),o.addEventListener("drror",g),o.addEventListener("message",u)}function f(){console.log("————————连接关闭——————")}function g(k){console.log("————————连接报错——————",k),R.alert("连接超时","提示",{callback:()=>{console.log(1)}})}return m(),o}const T=u=>($("data-v-7cf7ca7a"),u=u(),j(),u),Z={class:"chat"},ee={class:"room"},se=T(()=>t("div",{class:"header"},"多人聊天室（聊天记录保留1小时）",-1)),te={class:"body"},ae={class:"member-content"},oe={class:"name"},ne={key:0,class:"bubble"},le=["src"],ce={class:"time"},ie={key:1,class:"system-message"},re={class:"input"},de={class:"tools"},ue={class:"btn-box"},_e=T(()=>t("span",{class:"tag"},"shift + 回车键 换行",-1)),me={class:"member-list"},fe={__name:"index",setup(u){let a,c;const o=v(null),m=v(null),r=v(""),f=v([]),g=v([]);function k(){console.log("————————连接成功——————");const e={time:new Date().getTime(),userName:a,message:`${a}进入聊天室`,mode:"INTO"};c.send(JSON.stringify(e))}async function x(e){e=JSON.parse(e.data),e.mode==="ROOM"?f.value=e.userList:(g.value.push(e),r.value="",await q(),O())}function b(){if(r.value==="")return;const e={time:new Date().getTime(),userName:a,message:r.value,mode:"MESSAGE"};c.send(JSON.stringify(e))}function L(e){e.keyCode==13&&!e.shiftKey&&(e.preventDefault(),b())}function O(){o.value.scrollTo({top:o.value.scrollHeight,left:0,behavior:"smooth"})}function D(e){e=e.target.files[0];const i=new FileReader;i.addEventListener("load",()=>{const w={time:new Date().getTime(),userName:a,message:i.result,mode:"IMAGE"};c.send(JSON.stringify(w)),console.log(m.value.value=null)}),i.readAsDataURL(e)}async function A(){const e=await Q({url:"/chat/list",method:"get",data:{}});e.code===0&&(g.value=e.result,a=localStorage.getItem("userName"),c=X(x,k))}return A(),V(()=>{}),B(()=>{const e={time:new Date().getTime(),userName:a,message:`${a}退出了聊天室`,mode:"OUT"};c.send(JSON.stringify(e)),c.close()}),(e,i)=>{const w=H,S=W,C=J,G=U;return n(),l("div",Z,[t("div",ee,[se,t("div",te,[t("div",ae,[t("div",{class:"view",ref_key:"viewRef",ref:o},[(n(!0),l(N,null,I(g.value,(s,E)=>(n(),l("div",{key:E},[s.mode==="MESSAGE"||s.mode==="IMAGE"?(n(),l("div",{key:0,class:Y(["talk",y(a)===s.userName&&"talk-me"])},[t("div",oe,_(s.userName),1),s.mode==="MESSAGE"?(n(),l("div",ne,_(s.message),1)):h("",!0),s.mode==="IMAGE"?(n(),l("img",{key:1,class:"image-message",src:s.message,alt:""},null,8,le)):h("",!0),t("div",ce,_(y(z)(s.time).format("YYYY-MM-DD HH:mm:ss")),1)],2)):h("",!0),s.mode==="INTO"||s.mode==="OUT"?(n(),l("div",ie,_(s.message),1)):h("",!0)]))),128))],512),t("div",re,[d(w,{class:"message",modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=s=>r.value=s),rows:10,type:"textarea",placeholder:"输入信息...",resize:"none","input-style":"border: none",onKeydown:L},null,8,["modelValue"]),t("div",de,[d(C,{underline:!1,onClick:i[1]||(i[1]=s=>m.value.click())},{default:p(()=>[d(S,{size:"30",color:"#bababa"},{default:p(()=>[d(y(F))]),_:1})]),_:1})]),t("div",ue,[_e,d(G,{type:"primary",onClick:b},{default:p(()=>[M("发送")]),_:1}),t("input",{style:{display:"none"},ref_key:"imageRef",ref:m,type:"file",accept:"image/*",onChange:D},null,544)])])]),t("div",me,[t("p",null,"当前在线人数："+_(f.value.length)+" 人",1),(n(!0),l(N,null,I(f.value,(s,E)=>(n(),l("div",{key:E},[d(S,null,{default:p(()=>[d(y(K))]),_:1}),M(" "+_(s),1)]))),128))])])])])}}},pe=P(fe,[["__scopeId","data-v-7cf7ca7a"]]);export{pe as default};
