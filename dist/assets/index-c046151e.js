import{g as V,_ as B,d as G,h as H,E as U,i as J,p as Y,j as z,k as F}from"./index-4ee8697c.js";import{a as g,d as $,y as j,l,m as c,p as t,F as N,a7 as T,U as r,O as y,T as _,I as K,u as h,R as k,S as M,av as W,aw as q,n as P}from"./myVue-ccd9a49f.js";function x(u,o){const n="ws://www.fulili.cn:8001",a=new WebSocket(n),m=()=>{d()};function d(){a.addEventListener("open",o),a.addEventListener("close",f),a.addEventListener("drror",v),a.addEventListener("message",u)}function f(){console.log("————————连接关闭——————")}function v(p){console.log("————————连接报错——————",p),V.alert("连接超时","提示",{callback:()=>{console.log(1)}})}return m(),a}const L=u=>(W("data-v-76930c2f"),u=u(),q(),u),Q={class:"chat"},X={class:"room"},Z=L(()=>t("div",{class:"header"},"多人聊天室",-1)),ee={class:"body"},se={class:"member-content"},te={class:"name"},oe={key:0,class:"bubble"},ne=["src"],ae={class:"time"},le={key:1,class:"system-message"},ce={class:"input"},ie={class:"tools"},de={class:"btn-box"},re=L(()=>t("span",{class:"tag"},"shift + 回车键 换行",-1)),ue={class:"member-list"},_e={__name:"index",setup(u){let o=localStorage.getItem("userName"),n;o?n=x(S,p):setTimeout(()=>{o=localStorage.getItem("userName"),n=x(S,p)},1e3);const a=g(null),m=g(null),d=g(""),f=g([]),v=g([]);function p(){console.log("————————连接成功——————");const e={time:new Date().getTime(),userName:o,message:`${o}进入聊天室`,mode:"INTO"};n.send(JSON.stringify(e))}async function S(e){e=JSON.parse(e.data),e.mode==="ROOM"?f.value=e.userList:(v.value.push(e),d.value="",await P(),D())}function b(){if(d.value==="")return;const e={time:new Date().getTime(),userName:o,message:d.value,mode:"MESSAGE"};n.send(JSON.stringify(e))}function O(e){e.keyCode==13&&!e.shiftKey&&(e.preventDefault(),b())}function D(){a.value.scrollTo({top:a.value.scrollHeight,left:0,behavior:"smooth"})}function R(e){e=e.target.files[0];const i=new FileReader;i.addEventListener("load",()=>{const w={time:new Date().getTime(),userName:o,message:i.result,mode:"IMAGE"};n.send(JSON.stringify(w)),console.log(m.value.value=null)}),i.readAsDataURL(e)}return $(()=>{}),j(()=>{const e={time:new Date().getTime(),userName:o,message:`${o}退出了聊天室`,mode:"OUT"};n.send(JSON.stringify(e)),n.close()}),(e,i)=>{const w=G,I=F,A=H,C=U;return l(),c("div",Q,[t("div",X,[Z,t("div",ee,[t("div",se,[t("div",{class:"view",ref_key:"viewRef",ref:a},[(l(!0),c(N,null,T(v.value,(s,E)=>(l(),c("div",{key:E},[s.mode==="MESSAGE"||s.mode==="IMAGE"?(l(),c("div",{key:0,class:K(["talk",h(o)===s.userName&&"talk-me"])},[t("div",te,_(s.userName),1),s.mode==="MESSAGE"?(l(),c("div",oe,_(s.message),1)):k("",!0),s.mode==="IMAGE"?(l(),c("img",{key:1,class:"image-message",src:s.message,alt:""},null,8,ne)):k("",!0),t("div",ae,_(h(J)(parseInt(s.time)).format("YYYY-MM-DD HH:mm:ss")),1)],2)):k("",!0),s.mode==="INTO"||s.mode==="OUT"?(l(),c("div",le,_(s.message),1)):k("",!0)]))),128))],512),t("div",ce,[r(w,{class:"message",modelValue:d.value,"onUpdate:modelValue":i[0]||(i[0]=s=>d.value=s),rows:10,type:"textarea",placeholder:"输入信息...",resize:"none","input-style":"border: none",onKeydown:O},null,8,["modelValue"]),t("div",ie,[r(A,{underline:!1,onClick:i[1]||(i[1]=s=>m.value.click())},{default:y(()=>[r(I,{size:"30",color:"#bababa"},{default:y(()=>[r(h(Y))]),_:1})]),_:1})]),t("div",de,[re,r(C,{type:"primary",onClick:b},{default:y(()=>[M("发送")]),_:1}),t("input",{style:{display:"none"},ref_key:"imageRef",ref:m,type:"file",accept:"image/*",onChange:R},null,544)])])]),t("div",ue,[t("p",null,"当前在线人数："+_(f.value.length)+" 人",1),(l(!0),c(N,null,T(f.value,(s,E)=>(l(),c("div",{key:E},[r(I,null,{default:y(()=>[r(h(z))]),_:1}),M(" "+_(s),1)]))),128))])])])])}}},ge=B(_e,[["__scopeId","data-v-76930c2f"]]);export{ge as default};
